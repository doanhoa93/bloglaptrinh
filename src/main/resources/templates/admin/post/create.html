<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{template/admin/layout}">
<body>
<div class="content mt-3" layout:fragment="content">
    <link rel="stylesheet" href="http://cdn.quilljs.com/1.2.0/quill.snow.css">
    <link rel="stylesheet" href="http://cdn.quilljs.com/1.2.0/quill.bubble.css">

    <style>
        ng-quill-editor.ng-invalid .ql-container {
            border: 1px dashed red;
            border-radius: 5px !important;
        }
        .ql-editor{
            min-height: 300px;
        }
    </style>

    <!-- Scripts -->
    <script type="text/javascript" src="http://code.angularjs.org/1.5.8/angular.min.js"></script>
    <script type="text/javascript" src="http://cdn.quilljs.com/1.2.0/quill.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/ng-quill/2.2.1/ng-quill.min.js"></script>
    <script>
        // declare a module and load quillModule
        var myAppModule = angular.module('quillTest', ['ngQuill']);
        myAppModule.config(['ngQuillConfigProvider', function (ngQuillConfigProvider) {
            ngQuillConfigProvider.set();
        }]);
        myAppModule.controller('AppCtrl', [
            '$scope',
            '$timeout',
            function($scope, $timeout) {
                $scope.title = '';
                $scope.changeDetected = false;

                $scope.editorCreated = function (editor) {
                    console.log(editor);
                };
                $scope.contentChanged = function (editor, html, text) {
                    $scope.changeDetected = true;
                    console.log('editor: ', editor, 'html: ', html, 'text:', text);
                };
            }
        ]);

    </script>
    <!--<div class="alert alert-danger" style="z-index: 10000">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        <strong>Danger!</strong> Indicates a dangerous or potentially negative action.
    </div>-->
    <div class="msgBox"></div>
    <div class="animated fadeIn">
        <!--<p><button onclick="ajaxEntity();">ajaxEntity[POST, ResponseEntity]</button></p>
        <p></p>

        <div>
            <h3>Response-</h3>
            <div id="response-panel"></div>
        </div>-->

        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <h3 class="text-center">Thêm bài viết</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Credit Card -->
                        <div id="pay-invoice">
                            <div class="card-body">
                                <form action="" method="post" novalidate="novalidate">
                                    <div class="form-group">
                                        <label for="cc-title" class="control-label mb-1">Tiêu đề</label>
                                        <input id="cc-title" name="name" type="text" class="form-control" placeholder="Tiêu đề" aria-required="true" aria-invalid="false">
                                    </div>
                                    <div class="row">
                                        <div class="col-5">
                                            <div class="form-group">
                                                <label for="cc-exp" class="control-label mb-1">Expiration</label>
                                                <input id="cc-exp" name="cc-exp" type="tel" class="form-control cc-exp" value="" data-val="true" data-val-required="Please enter the card expiration" data-val-cc-exp="Please enter a valid month and year" placeholder="MM / YY" autocomplete="cc-exp">
                                                <span class="help-block" data-valmsg-for="cc-exp" data-valmsg-replace="true"></span>
                                            </div>
                                        </div>
                                        <div class="col-7">
                                            <label for="x_card_code" class="control-label mb-1">Tag</label>
                                            <div class="input-group">
                                                <input id="x_card_code" name="x_card_code" type="tel" class="form-control cc-cvc" value="" data-val="true" data-val-required="Please enter the security code" data-val-cc-cvc="Please enter a valid security code" autocomplete="off">
                                                <span class="help-block" data-valmsg-for="cc-exp" data-valmsg-replace="true"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label mb-1">Nội dung</label>
                                        <div class="animated fadeIn">
                                            <ng-quill-editor ng-model="title" on-editor-created="editorCreated(editor)" on-content-changed="contentChanged(editor, html, text)">

                                            </ng-quill-editor>
                                        </div>
                                        <span class="help-block" data-valmsg-for="cc-number" data-valmsg-replace="true"></span>
                                    </div>
                                    <div class="form-group"></div>
                                    <div class="row">
                                        <div class="col-4"></div>
                                        <div class="col-4">
                                            <a id="savePost" class="btn btn-lg btn-primary btn-block" style="color: white">
                                                <i class="fa fa-dot-circle-o"></i>
                                                <span id="post-button-amount">Thêm bài viết</span>
                                                <span id="post-button-sending" style="display:none;">Sending…</span>
                                            </a>
                                            <a id="savePosts" class="btn btn-lg btn-primary btn-block" style="color: white">
                                                <i class="fa fa-dot-circle-o"></i>
                                                <span id="post-button-amounts">Thêm bài</span>
                                            </a>
                                        </div>
                                        <div id="resultContainer" style="display: none;">
                                            <hr/>
                                            <h4 style="color: green;">JSON Response From Server</h4>
                                            <pre style="color: green;">
                                            <code></code>
                                           </pre>
                                        </div>
                                        <div class="col-4"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <section layout:fragment="js">
        <script>
            var _response = $('#response-panel');
            function ajaxEntity(){
                var language = 'vn';
                var status = 'PUBLISHED';
                var views = parseInt('10');
                var createdAt = '2018-11-11 14:30:54';
                var updatedAt = '2018-11-11 14:30:54';
                var body = 'Hello';
                var postJson = new Object();
                postJson.language = language;
                postJson.status = status;
                postJson.views = views;
                postJson.createdAt = createdAt;
                postJson.updatedAt = updatedAt;
                postJson.body = body;

                $.ajax({
                    type    : 'POST', // method
                    url     : 'http://localhost:8080/entity/create',
                    async   : 'true', // true
                    data: JSON.stringify(postJson),
                    contentType : 'application/json',
                    success : function(data, status, xhr){
                        responseJson(data);
                    },
                    error   : function(error){
                        console.log("error", error);
                        responseError(error);
                    }
                });
            }
            function convertJson(data){
                return JSON.stringify(data, true, 2);
            }

            function responseJson(data){
                _response.html(convertJson(data));
            }

            function responseError(data){
                _response.html(data.responseText);
            }
            jQuery(function($) {
                $('#editor').parents('form').on('submit', function () {
                    $('#textarea-input').val($('.fr-view').html());
                    return true;
                })
            });
            $('#savePost').click(function () {
               /* $('#packagename').val() == undefined ? '' : $("#packagename").val().trim();*/
                var title = 'hahaha';
                var language = 'vn';
                var status = 'PUBLISHED';
                var views = parseInt('10');
                var createdAt = '2018-11-11 14:30:54';
                var updatedAt = '2018-11-11 14:30:54';
                var body = $('.fr-view').html();
                var postJson = new Object();
                postJson.title = $('#cc-title').val();
                postJson.language = language;
                postJson.status = status;
                postJson.views = views;
                postJson.createdAt = createdAt;
                postJson.updatedAt = updatedAt;
                postJson.body = $('.fr-view').html();
                if (validateData()) {
                    $.ajax({
                        type    : 'POST',
                        url     : 'http://localhost:8080/admin_/post/create',
                        async   : 'true',
                        data: JSON.stringify(postJson),
                        contentType : 'application/json',
                        dataType: "json",
                        error: function (request, status, error) {
                            console.log('Error ' + request.responseText + "\n" + status + "\n" + error);
                            showMessage('error', 'Tạo bài viết thất bại!', '.msgBox');
                        },
                        success: function (data) {
                            console.log('success');
                            console.log(data);
                            showMessage('success', 'Tạo bài viết thành công.', '.msgBox');
                        }
                    });
                } else {
                    showMessage('error', 'Dữ liệu không hợp lê!', '.msgBox');
                    console.log('error');
                }
            });


            $('#savePosts').click(function () {
                var contextRoot = "${pageContext.request.contextPath}";
                $('input').next().remove();
                var customerJson = new Object();
                customerJson.name = $('#cc-title').val();
                customerJson.email = 'hoa9x3@gmail.com';
                customerJson.age = parseInt('20');
                customerJson.phone = '2323Dwed2332';
                if (validateData()) {
                    $.ajax({
                        type    : 'POST',
                        url     : 'http://localhost:8080/cust/save',
                        async   : 'true',
                        data: JSON.stringify(customerJson),
                        contentType : 'application/json',
                        dataType: "json",
                        error: function (request, status, error) {
                            console.log('status ' + request.responseText + "\n" + status + "\n" + error);
                        },
                        success: function (dataResponse) {
                            if(dataResponse.isSuccess){
                                $('#resultContainer pre code').text(JSON.stringify(dataResponse.paramObject));
                                $('#resultContainer').show();
                                $('input').removeClass("is-invalid");
                            }else{
                                //Set error messages
                                $.each(dataResponse.errorMessages,function(key,value){
                                    $('input[name='+key+']').after('<span class="error">'+value+'</span>');
                                    $('input[name='+key+']').addClass("is-invalid");
                                });
                            }
                        }
                    });
                } else {
                    console.log('error');
                }
            });
            function validateData() {
                return true;
            }
        </script>
    </section>
</div>
</body>
</html>